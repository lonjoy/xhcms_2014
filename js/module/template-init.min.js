define(function(b,a,c){var e=jQuery,d={append:false,sourceMethod:"get",sourceData:function(){return{}},nonResult:'<div class="no-content" style="padding-top: 150px;"><span class="nocon-bid"></span><span class="nocon-detail">\u6682\u65e0\u5185\u5bb9\uff01</span></div>'};Handlebars.registerHelper("division",function(g,f){return g/f});return{__simple__:function(g,i){if(typeof g.begin==="function"){g.begin.call(this,g,i)}var m=e(g.tmpl).html();var n=e(g.target);var j=Handlebars.compile(m)(g.source),h=e("<div>"+j+"</div>");var l=h.children(".currentPage").hide().html(),k=Math.ceil(h.children(".totalPage").hide().html());if(k===0){h.html(g.nonResult)}if(g.prepend){n.prepend(h.html())}else{g.append?n.append(h.html()):n.html(h.html())}var f=null;if(g.pagination){if(k!="0"){e(g.pagination).show()}g.url=location.href.replace(/([?])?[&]?toPage=\w*&?/,"$1");f=e(g.pagination).toPager({currentPage:Math.floor(l)||1,totalPage:k|0},!i);if(typeof g.callback==="function"){g.callback.call(this,g,f,i)}else{if(f&&i){f.on("switch",function(o,p){location.href=g.url+(g.url.indexOf("?")>-1?("&toPage="+p.toPage):("?toPage="+p.toPage))})}}}},__ajax__:function(k,j){var g=e(k.tmpl).html();var i=e(k.target);var h=(k.sourceMethod=="post")?"post":"get";var f=this;if(typeof k.before==="function"){k.before.call(f,k,j)}else{if(!k.prepend&&!k.append){i.html("")}i.append(e('<div class="list-wait">\u7b49\u5f85\u4e2d...</div>'))}e[h](k.sourceUrl,e.extend({t:new Date().getTime(),toPage:k.toPage||"",pageSize:15},k.sourceData()),function(o){if(o.code!=200){i.html(k.nonResult);return}e(k.pagination).hide();k.source=o;if(typeof k.begin==="function"){k.begin.call(f,k,j)}var m=Handlebars.compile(g)(k.source),r=e("<div>"+m+"</div>");var n=r.children(".currentPage").hide().html(),l=Math.ceil(r.children(".totalPage").hide().html());if(l===0){r.html(k.nonResult)}r.remove(".list-wait");if(k.prepend){i.prepend(r.html())}else{k.append?i.append(r.html()):i.html(r.html())}var q=null;if(k.pagination){if(l!="0"){e(k.pagination).show()}q=e(k.pagination).toPager({currentPage:Math.floor(n)||1,totalPage:l|0},!j);if(q&&j){q.on("switch",function(p,s){k.toPage=s.toPage;f.__ajax__(k)})}}if(typeof k.callback==="function"){k.callback.call(f,k,q,j)}},"json")},__init__:function(g,h){var f=e(g.tmpl),i=this;return f.each(function(){var j=e(this),k=e.extend(e.extend({},d),{sourceUrl:j.attr("data-url"),target:j.attr("data-target"),append:j.attr("data-append"),prepend:j.attr("data-prepend"),pagination:j.attr("data-pagination"),sourceMethod:j.attr("data-method")},g);if(k.sourceUrl){i.__ajax__(k,h)}else{i.__simple__(k,h)}})},init:function(f){return this.__init__(f,true)},refresh:function(f){return this.__init__(f,false)}}});
