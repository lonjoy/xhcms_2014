define(function(t){var e=jQuery,a={append:!1,sourceMethod:"get",sourceData:function(){return{}},page:{size:"page.size",to:"page.pn"},nonResult:'<div class="no-content" style="padding-top: 150px;"><span class="nocon-bid"></span><span class="nocon-detail">暂无内容！</span></div>'};return Handlebars.registerHelper("division",function(t,e){return t/e}),{__simple__:function(a,n){"function"==typeof a.begin&&a.begin.call(this,a,n);var i=e(a.tmpl).html(),o=e(a.target),r=Handlebars.compile(i)(a.source),l=e("<div>"+r+"</div>"),p=l.children(".currentPage").hide().html(),c=Math.ceil(l.children(".totalPage").hide().html());e(a.pagination).hide(),0===c&&l.html(a.nonResult),a.prepend?o.prepend(l.html()):a.append?o.append(l.html()):o.html(l.html());var d=null;a.pagination&&t(["form-style"],function(){"0"!=c&&e(a.pagination).show(),a.url=location.href.replace(new RegExp("([?])?[&]?"+a.page.to+"=\\w*&?"),"$1"),d=e(a.pagination).toPager({currentPage:Math.floor(p)||1,totalPage:0|c},!n),"function"==typeof a.callback?a.callback.call(this,a,d,n):d&&n&&d.on("switch",function(t,e){location.href=a.url+(a.url.indexOf("?")>-1?"&"+a.page.to+"="+e.toPage:"?"+a.page.to+"="+e.toPage)})})},__ajax__:function(a,n){var i=e(a.tmpl).html(),o=e(a.target),r="post"==a.sourceMethod?"post":"get",l=this;"function"==typeof a.before?a.before.call(l,a,n):a.prepend||a.append||(o.html(""),o.append(e('<div class="list-wait">等待中...</div>')));var p={};"get"===r&&(p.t=(new Date).getTime()),a.pagination&&(p[a.page.to]=a.toPage||1,p[a.page.size]=10),e.extend(p,a.sourceData()),e[r](a.sourceUrl.replace(/\{\{(.*)\}\}/g,function(t,e){var a=p[e];return"undefined"!=typeof a?a:void 0}),p,function(r){if(r.code&&200!=r.code)return void o.html(a.nonResult);e(a.pagination).hide(),a.source=r,"function"==typeof a.begin&&a.begin.call(l,a,n);var p=Handlebars.compile(i)(a.source),c=e("<div>"+p+"</div>"),d=c.children(".currentPage").remove().html(),s=Math.ceil(c.children(".totalPage").remove().html());0===s&&c.html(a.nonResult),c.remove(".list-wait"),a.prepend?o.prepend(c.html()):a.append?o.append(c.html()):o.html(c.html());var u=null;a.pagination&&t(["form-style"],function(){u=e(a.pagination).toPager({currentPage:Math.floor(d)||1,totalPage:0|s,"switch":function(t,n){a.toPage=n.toPage,e(this).hide(),l.__ajax__(a)}},!n),"0"!=s&&u.show()}),"function"==typeof a.callback&&a.callback.call(l,a,u,n)},a.dataType||"json")},__init__:function(t,n){var i=e(t.tmpl),o=this;return i.each(function(){var i=e(this),r=e.extend(e.extend({},a),{sourceUrl:i.attr("data-url"),target:i.attr("data-target"),append:i.attr("data-append"),prepend:i.attr("data-prepend"),pagination:i.attr("data-pagination"),sourceMethod:i.attr("data-method"),dataType:i.attr("data-type")},t);r.sourceUrl?o.__ajax__(r,n):o.__simple__(r,n)})},init:function(t){return this.__init__(t,!0)},refresh:function(t){return this.__init__(t,!1)}}});